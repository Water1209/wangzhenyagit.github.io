
### 理论分析 ###
人脸特征向量256维，每个特征值为一个4字节浮点型，rowkey长度时间+摄像机id+seq？，可以近似取一条记录为1K。

10快机械硬盘，Hbase中的特征向量单独列族，在磁盘上是连续的，那么假设能达到硬盘的最大读取速度100MB/s（理论上可以更高，但7200转的，一般不会超过200M），假设每秒能读取1GB的数据，每条数据1k，那么每秒的读取的数据条数是1M也就是100w。假设有1亿的数据，需要100s，与实际测试值差不多。

另外，系统瓶颈也不是这全库的扫描和特征比对，而是实时的比对，100w的对比库，每秒100张的速度，而应景配置是双cpu，每个cpu有12核心双线程，计算速度大概是1秒100w次比对，而实际需求是每秒1亿次比对。

### 设计存在疑问 ###

**Hbase对特征向量有进行压缩？**  
特征向量中的特征是浮点型的，压缩效率尚不清楚，如压缩，解压会消耗一部分计算资源。

**单个机器能挂多少块硬盘？**  
ext3一个日志文件系统。单个文件最大限制16TB，该文件系统最大支持32TB的容量。
ext4Theodore Tso领导的开发团队实现,Linux系统下的日志文件系统。单个文件最大限制16TB，该文件系统最大支持1EB的容量。

**使用RAID10？**  
实际中并没有使用，因为有HDFS的容错机制。上面场景下对于写入的性能不是瓶颈，读取时候，磁盘已经基本到了所有的物理上瓶颈。

**Hbase的scan方式？能否达到磁盘的瓶颈？**
全表扫描的，可以考虑SnapshotScanMR方式。
[HBase最佳实践 – Scan用法大观园](http://hbasefly.com/2017/10/29/hbase-scan-3/)

**使用固态硬盘？**  
与容量有关系，越大速度越快，但是一般极限在500M/s，最多提升5倍性能，但是一是固态硬盘寿命短，二是成本问题。

**多块磁盘？**  
对于磁盘容量降低，数目增多，如4T的机械，变成4块1T的机械，是可以提高IO的。

**spark对于CPU的消耗，是否有很多调用任务？**  
尚不清楚。

### 匹配算法 ###
[图像检索：再叙ANN Search](http://yongyuan.name/blog/ann-search.html)